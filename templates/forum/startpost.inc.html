{% load i18n %}
{% load markup %}
{% load cache %}

{% cache 86400 post startpost.pk %}

<div class='news'>
    <h3>
        {{ startpost.get_flags|safe }}
        <a href='{{ startpost.get_section_url }}'>{{ startpost.get_section_name }}</a> →
        <a href='{{ startpost.get_absolute_url }}'>{{ startpost.title }}</a>
    </h3>
    <div class='block'>
        {% if strippost %}
            {{ startpost.get_strip_text|safe }}
        {% else %}
            {{ startpost.get_text|safe }}
        {% endif %}
        <div class='tags'>
            {% trans "Tags" %}:
            {{ startpost.get_tag_url_list|safe }}
        </div>
        <div>
            [<span class='vote-positive'><a class='vote-positive' 
                   href='{% url blog.views.vote_generic startpost.pk 0 %}' 
                   id='positive-{{ startpost.pk }}'>▲</a></span>]
            <span id='rating-{{ startpost.pk }}'>
                {{ startpost.rating }}
            </span>
            [<span class='vote-negative'><a class='vote-negative' 
                   href='{% url blog.views.vote_generic startpost.pk 1 %}'
                   id='negative-{{ startpost.pk }}'>▼</a></span>]
            | {% trans "Author" %}:
            <span class='user'>
                <a href='{% url userauth.views.profile_view startpost.owner.pk %}'>
                    {{ startpost.owner.profile.get_html_visible_name|safe }}
                </a>
            </span>
            ( 
                {{ startpost.created|date:"d.m.Y H:i" }}
            )
{% endcache %}
            {% if startpost.thread %}
            |
            <span class='comments'>
            {{ startpost.get_comments_count|safe }}
            </span>
            {% endif %}
        </div>
        {% if startpost.is_edited %}
        <div class='editby'>
            {% trans "Last edited by" %}
            <span class='user'>
            <a href='{{ startpost.get_last_edit_user_url }}'>{{ startpost.get_last_edit_user }}</a>
            </span>
            {{ startpost.get_last_edit_date|date:"d.m.Y H:i" }} 
            (
            <span class='comments'>
            <a href='{{ startpost.get_last_edit_url }}'>{% trans "Total edits" %}: {{ startpost.get_edited_count }}</a>
            </span>
            )
        </div>
        {% endif %}

        <div class='controls'>
            {% if startpost.removed %}
                [<a href="{% url userauth.views.rewards startpost.owner.pk %}">{% trans "This post was removed" %}</a>]
            {% else %}
                {% if user.is_staff %} 
                    [<a href="{% url forum.views.remove startpost.pk %}">{% trans "Remove" %}</a>]
                {% endif %}
                {% if user = startpost.owner or user.is_staff %}
                    [<a href="{{ startpost.get_edit_url }}">{% trans "Edit" %}</a>]
                    {% if startpost.forum %}
                        {% if startpost.solved %}
                            [<a href="{% url forum.views.post_solve startpost.pk %}">{% trans "Mark as unsolved" %}</a>]
                        {% else %}
                            [<a href="{% url forum.views.post_solve startpost.pk %}">{% trans "Mark as solved" %}</a>]
                        {% endif %}
                    {% endif %}
                {% endif %}
                {% if startpost.closed %}
                    [<a href="{{ startpost.get_section_url }}">{% trans "This topic is closed" %}</a>]
                {% else %}
                        [<a href="{% url forum.views.reply startpost.pk %}">{% trans "Add a comment" %}</a>]
                {% endif %}
            {% endif %}
        </div>
    </div>
</div>
